---
title: JSä¸­çš„äº‹ä»¶å¾ªç¯æœºåˆ¶
tags:
  - JS
  - å­¦ä¹ 
cover: 'https://pic.imgdb.cn/item/65cdd6cf9f345e8d032f5627.jpg'
keywords: å­¦ä¹  å‰ç«¯ JS
categories: å‰ç«¯
abbrlink: 42193
date: 2024-3-1 12:55:12
---

# JS ä¸­çš„äº‹ä»¶å¾ªç¯æœºåˆ¶

> è¿™ä¸ªç½‘ç«™å¯ä»¥å¯è§†åŒ–è¿è¡Œ https://www.jsv9000.app

è¿™ä¸ªé¢è¯•ç»å¸¸é—®è¯¶ï¼Œä½†æ˜¯æˆ‘å¥½å‡ æ¬¡å›ç­”çš„éƒ½æ˜¯ä¸å°½å¦‚äººæ„ï¼Œè¿™æ¬¡æ¥å¥½å¥½ææ‡‚ä¸€ä¸‹çœ‹çœ‹ ğŸ˜¡ã€‚

## å•çº¿ç¨‹çš„ JS

é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ JS æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºå•¥ ğŸ˜§ï¼Ÿ

å› ä¸ºä¸€å¼€å§‹è®¾è®¡ä¹‹åˆï¼Œä»–åªæ˜¯ä¸€ä¸ªæµè§ˆå™¨çš„è„šæœ¬è¯­è¨€ï¼Œä¸»è¦å°±æ˜¯æ“æ§ DOM å’Œä¸ç”¨æˆ·äº’åŠ¨ï¼Œå¦‚æœä»–æ˜¯å¤šçº¿ç¨‹çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ª DOMï¼Œè°çŸ¥é“ä¼šå‘ç”Ÿå•¥ã€‚

å½“ç„¶ JS ä¹Ÿå¯ä»¥å¤šçº¿ç¨‹ï¼Œä¸‹é¢å¼•ç”¨[é˜®ä¸€å³°åšå®¢](https://www.ruanyifeng.com/blog/2014/10/event-loop.html)çš„è¯ï¼š

> ä¸ºäº†åˆ©ç”¨å¤šæ ¸ CPU çš„è®¡ç®—èƒ½åŠ›ï¼ŒHTML5 æå‡º Web Worker æ ‡å‡†ï¼Œå…è®¸ JavaScript è„šæœ¬åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å­çº¿ç¨‹å®Œå…¨å—ä¸»çº¿ç¨‹æ§åˆ¶ï¼Œä¸”ä¸å¾—æ“ä½œ DOMã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ–°æ ‡å‡†å¹¶æ²¡æœ‰æ”¹å˜ JavaScript å•çº¿ç¨‹çš„æœ¬è´¨ã€‚

## ä»»åŠ¡é˜Ÿåˆ—

é‚£è¿™æ ·æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½æ”¾åˆ°äº†ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œã€‚ä½†æ˜¯è¿™æ ·åº”è¯¥è¿˜ä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚æœ‰çš„ä»»åŠ¡è®¡ç®—é‡å¾ˆå¤§ï¼Œæœ‰çš„ä»»åŠ¡å ç”¨æ—¶é—´å¾ˆé•¿ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åé¢çš„ä»»åŠ¡æ— æ³•æ‰§è¡Œï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é¡µé¢å¡æ­»(å› ä¸ºæµè§ˆå™¨çš„æ¸²æŸ“çº¿ç¨‹å’Œ JS çº¿ç¨‹æ˜¯äº’æ–¥çš„)ã€‚

å¦‚æœæ˜¯å‰è€…ï¼ŒCPU å¿™ä¸è¿‡æ¥ï¼Œå€’ä¹Ÿæ˜¯åˆç†çš„ï¼Œç›´æ¥ç­‰å¾…è¿è¡Œç»“æŸå°±è¡Œã€‚ä½†æ˜¯å¦‚æœæ˜¯åè€…ï¼ŒCPU ç©ºé—²ï¼Œä½†æ˜¯å› ä¸º IO è®¾å¤‡æ…¢ï¼Œå…¸å‹çš„å°±æ˜¯ä»ç½‘ç»œæ¥å£åå»æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±æ²¡å¿…è¦ç­‰å¾…ä»–ï¼Œå¯ä»¥å…ˆå»å¤„ç†åˆ«çš„ä»»åŠ¡ï¼Œç­‰ä»–å¥½äº†å†å›æ¥å¤„ç†ã€‚

æ‰€ä»¥è¯´ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠä»»åŠ¡åˆ†ä¸ºä¸¤ç±»ï¼ŒåŒæ­¥(sync)ä»»åŠ¡ï¼Œå’Œå¼‚æ­¥(async)ä»»åŠ¡ã€‚åŒæ­¥ä»»åŠ¡æŒ‡çš„æ˜¯ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸Šæ’é˜Ÿæ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¿…é¡»å¾—æŒ‰é¡ºåºæ‰§è¡Œçš„äº†ã€‚å¼‚æ­¥ä»»åŠ¡æŒ‡çš„æ˜¯ï¼Œä¸è¿›å…¥ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯è¿›å…¥ä»»åŠ¡é˜Ÿåˆ—(task queue)çš„ä»»åŠ¡ï¼Œåªæœ‰ä»»åŠ¡é˜Ÿåˆ—é€šçŸ¥ä¸»çº¿ç¨‹ï¼ŒæŸä¸ªå¼‚æ­¥ä»»åŠ¡å¯ä»¥æ‰§è¡Œäº†ï¼Œè¿™ä¸ªä»»åŠ¡æ‰ä¼šè¿›å…¥åˆ°ä¸»çº¿ç¨‹ä¸­ä¸­æ‰§è¡Œã€‚

ä¸‹é¢å¼•ç”¨é˜®ä¸€å³°çš„åšå®¢ï¼š

> å…·ä½“æ¥è¯´ï¼Œå¼‚æ­¥æ‰§è¡Œçš„è¿è¡Œæœºåˆ¶å¦‚ä¸‹ã€‚ï¼ˆåŒæ­¥æ‰§è¡Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå®ƒå¯ä»¥è¢«è§†ä¸ºæ²¡æœ‰å¼‚æ­¥ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œã€‚ï¼‰
>
> ï¼ˆ1ï¼‰æ‰€æœ‰åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ˆexecution context stackï¼‰ã€‚
> ï¼ˆ2ï¼‰ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ª"ä»»åŠ¡é˜Ÿåˆ—"ï¼ˆtask queueï¼‰ã€‚åªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æœï¼Œå°±åœ¨"ä»»åŠ¡é˜Ÿåˆ—"ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚
> ï¼ˆ3ï¼‰ä¸€æ—¦"æ‰§è¡Œæ ˆ"ä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–"ä»»åŠ¡é˜Ÿåˆ—"ï¼Œçœ‹çœ‹é‡Œé¢æœ‰å“ªäº›äº‹ä»¶ã€‚é‚£äº›å¯¹åº”çš„å¼‚æ­¥ä»»åŠ¡ï¼Œäºæ˜¯ç»“æŸç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ‰§è¡Œæ ˆï¼Œå¼€å§‹æ‰§è¡Œã€‚
> ï¼ˆ4ï¼‰ä¸»çº¿ç¨‹ä¸æ–­é‡å¤ä¸Šé¢çš„ç¬¬ä¸‰æ­¥ã€‚

### å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡

åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œåˆæœ‰ä¿©ç§ä»»åŠ¡ï¼Œå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ã€‚

å®ä»»åŠ¡ï¼ˆmacro-taskï¼‰æ˜¯ä¸€ç»„éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ä»»åŠ¡æ“ä½œï¼Œå®ƒä»¬è¢«æ·»åŠ åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚å¸¸è§çš„å®ä»»åŠ¡åŒ…æ‹¬æ•´ä½“çš„ script ä»£ç å—ã€setTimeoutã€setIntervalã€I/O æ“ä½œã€UI æ¸²æŸ“ç­‰ã€‚å®ä»»åŠ¡çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨å½“å‰æ‰§è¡Œæ ˆä¸ºç©ºæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œå¹¶åœ¨æ‰§è¡Œå®Œè¯¥ä»»åŠ¡åï¼Œå†æ¬¡æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–çš„å®ä»»åŠ¡éœ€è¦æ‰§è¡Œã€‚

å¾®ä»»åŠ¡ï¼ˆmicro-taskï¼‰æ˜¯ä¸€ç»„éœ€è¦åœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œç»“æŸåç«‹å³æ‰§è¡Œçš„ä»»åŠ¡æ“ä½œï¼Œå®ƒä»¬è¢«æ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚å¸¸è§çš„å¾®ä»»åŠ¡åŒ…æ‹¬ Promise çš„å›è°ƒå‡½æ•°ï¼ˆ.then()ã€.catch()ã€.finally()ï¼‰ã€MutationObserverã€process.nextTick ç­‰ã€‚å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨å½“å‰å®ä»»åŠ¡æ‰§è¡Œç»“æŸåã€ä¸‹ä¸€ä¸ªå®ä»»åŠ¡å¼€å§‹ä¹‹å‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸»çº¿ç¨‹æ‰§è¡Œå®Œå½“å‰å®ä»»åŠ¡åï¼Œä¼šç«‹å³æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼Œç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼Œç„¶åå†æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚

## äº‹ä»¶ä¸å›è°ƒå‡½æ•°

ä¸Šæ–‡æåˆ°ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­æ”¾ç½®çš„æ˜¯äº‹ä»¶ï¼Œå½“ IO è®¾å¤‡å®Œæˆä¸€é¡¹ä»»åŠ¡ï¼Œå°±ä¼šåœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªäº‹ä»¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥äº§ç”Ÿä¸€äº›äº‹ä»¶ï¼Œåªè¦æŒ‡å®šè¿‡å›è°ƒå‡½æ•°ï¼Œè¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶å°±ä¼šè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸»çº¿ç¨‹çš„è¯»å–ã€‚

> æ‰€è°“"å›è°ƒå‡½æ•°"ï¼ˆcallbackï¼‰ï¼Œå°±æ˜¯é‚£äº›ä¼šè¢«ä¸»çº¿ç¨‹æŒ‚èµ·æ¥çš„ä»£ç ã€‚å¼‚æ­¥ä»»åŠ¡å¿…é¡»æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œå½“ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå°±æ˜¯æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•°ã€‚

## äº‹ä»¶å¾ªç¯

ä¸»çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è¯»å–äº‹ä»¶çš„è¿‡ç¨‹æ˜¯å¾ªç¯ä¸æ–­çš„ï¼Œæ‰€ä»¥è¯´è¿™æ•´ä¸ªè¿è¡Œæœºåˆ¶åˆè¢«ç§°ä¸ºäº‹ä»¶å¾ªç¯(Event Loop)ã€‚

ç®€è¦æè¿°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ï¼Œé¦–å…ˆæ‰§è¡Œå½“å‰ä»£ç è¿™ä¸ªå®ä»»åŠ¡ï¼Œç„¶åæ¸…ç©ºè¿™ä¸ªå®ä»»åŠ¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå†ä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºæ¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ”¾å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼Œç„¶åé‡å¤ ğŸ” è¿™ä¸ªè¿‡ç¨‹ã€‚

## å®šæ—¶å™¨ å®ä»»åŠ¡

ä»»åŠ¡é˜Ÿåˆ—ä¸­é™¤äº†å¼‚æ­¥ä»»åŠ¡ï¼Œè¿˜å¯ä»¥æ”¾ç½®å®šæ—¶äº‹ä»¶ï¼Œä¸€èˆ¬æ˜¯ setTimeout() å’Œ setInterval()ï¼Œä»–ä»¬çš„å†…éƒ¨è¿è¡Œæœºåˆ¶æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åªè®¨è®º setTimeout()å°±å¯ä»¥ã€‚

```js
const { log } = console

log(1)
setTimeout(() => {
  log(2)
}, 100)
log(3)
```

è¾“å‡ºå¾ˆæ˜æ˜¾ï¼Œ132ï¼Œå› ä¸ºå®šæ—¶å™¨æŠŠ 2 å»¶è¿Ÿäº†ã€‚

```js
setTimeout(() => {
  log(1)
}, 0)
log(2)
```

é‚£æ— å»¶æ—¶çš„å®šæ—¶å™¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ 21ï¼Œè¿™è¡¨ç¤ºå½“å‰çš„æ‰§è¡Œæ ˆæ¸…ç©ºåï¼Œç«‹åˆ»æ‰§è¡ŒæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚

æ‰€ä»¥è¯´ï¼ŒsetTimeout(fn, 0) çš„å«ä¹‰å°±æ˜¯ï¼ŒæŒ‡å®šè¿™ä¸ªä»»åŠ¡åœ¨ä¸»çº¿ç¨‹æœ€æ—©å¯å¾—çš„ç©ºé—²æ—¶é—´æ‰§è¡Œã€‚

> HTML5 æ ‡å‡†è§„å®šäº† setTimeout()çš„ç¬¬äºŒä¸ªå‚æ•°çš„æœ€å°å€¼ï¼ˆæœ€çŸ­é—´éš”ï¼‰ï¼Œä¸å¾—ä½äº 4 æ¯«ç§’ï¼Œå¦‚æœä½äºè¿™ä¸ªå€¼ï¼Œå°±ä¼šè‡ªåŠ¨å¢åŠ ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè€ç‰ˆæœ¬çš„æµè§ˆå™¨éƒ½å°†æœ€çŸ­é—´éš”è®¾ä¸º 10 æ¯«ç§’ã€‚å¦å¤–ï¼Œå¯¹äºé‚£äº› DOM çš„å˜åŠ¨ï¼ˆå°¤å…¶æ˜¯æ¶‰åŠé¡µé¢é‡æ–°æ¸²æŸ“çš„éƒ¨åˆ†ï¼‰ï¼Œé€šå¸¸ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ¯ 16 æ¯«ç§’æ‰§è¡Œä¸€æ¬¡ã€‚è¿™æ—¶ä½¿ç”¨ requestAnimationFrame()çš„æ•ˆæœè¦å¥½äº setTimeout()ã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒsetTimeout()åªæ˜¯å°†äº‹ä»¶æ’å…¥äº†"ä»»åŠ¡é˜Ÿåˆ—"ï¼Œå¿…é¡»ç­‰åˆ°å½“å‰ä»£ç ï¼ˆæ‰§è¡Œæ ˆï¼‰æ‰§è¡Œå®Œï¼Œä¸»çº¿ç¨‹æ‰ä¼šå»æ‰§è¡Œå®ƒæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚è¦æ˜¯å½“å‰ä»£ç è€—æ—¶å¾ˆé•¿ï¼Œæœ‰å¯èƒ½è¦ç­‰å¾ˆä¹…ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰åŠæ³•ä¿è¯ï¼Œå›è°ƒå‡½æ•°ä¸€å®šä¼šåœ¨ setTimeout()æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œã€‚

> æ³¨æ„ï¼š setTimeOut å¹¶ä¸æ˜¯ç›´æ¥çš„æŠŠä½ çš„å›è°ƒå‡½æ•°æ”¾è¿›ä¸Šè¿°çš„å¼‚æ­¥é˜Ÿåˆ—ä¸­å»ï¼Œè€Œæ˜¯åœ¨å®šæ—¶å™¨çš„æ—¶é—´åˆ°äº†ä¹‹åï¼ŒæŠŠå›è°ƒå‡½æ•°æ”¾åˆ°æ‰§è¡Œå¼‚æ­¥é˜Ÿåˆ—ä¸­å»ã€‚å¦‚æœæ­¤æ—¶è¿™ä¸ªé˜Ÿåˆ—å·²ç»æœ‰å¾ˆå¤šä»»åŠ¡äº†ï¼Œé‚£å°±æ’åœ¨ä»–ä»¬çš„åé¢ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆ setTimeOut ä¸ºä»€ä¹ˆä¸èƒ½ç²¾å‡†çš„æ‰§è¡Œçš„é—®é¢˜äº†ã€‚setTimeOut æ‰§è¡Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
>
> ä¸»è¿›ç¨‹å¿…é¡»æ˜¯ç©ºé—²çš„çŠ¶æ€ï¼Œå¦‚æœåˆ°æ—¶é—´äº†ï¼Œä¸»è¿›ç¨‹ä¸ç©ºé—²ä¹Ÿä¸ä¼šæ‰§è¡Œä½ çš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°éœ€è¦ç­‰åˆ°æ’å…¥å¼‚æ­¥é˜Ÿåˆ—æ—¶å‰é¢çš„å¼‚æ­¥å‡½æ•°éƒ½æ‰§è¡Œå®Œäº†ï¼Œæ‰ä¼šæ‰§è¡Œ

æ¥ä¿©ä¸ªä¾‹å­

```js
console.time('time')
setTimeout(() => {
  console.timeEnd('time')
}, 10)
// time: 10.6201171875 ms
```

è¿™æ ·å°±æ˜¯ç›¸å¯¹æ¯”è¾ƒå‡†æ—¶çš„

```js
console.time('time')
let i = 0
for (let j = 1; j < 100000; j++) i += j
setTimeout(() => {
  console.timeEnd('time')
}, 10)
// time: 14.416015625 ms
```

è¿™é‡Œå°±æ˜¯å› ä¸ºä¸Šé¢çš„å¾ªç¯æ¶ˆè€—äº†è¾ƒå¤šçš„æ—¶é—´ï¼Œæ‰€ä»¥åœ¨å®šæ—¶å™¨æ—¶é—´åˆ°äº†ä¹‹åå¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè€Œæ˜¯ç­‰å¾…è€—æ—¶ä»»åŠ¡å®Œç»“ï¼Œæ‰å»æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

æ€»ç»“è¯´å°±æ˜¯ï¼Œå®šæ—¶å™¨çš„å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶é—´é—´éš” >=10msã€‚ä»¥åŠï¼Œåˆ›å»ºå®šæ—¶å™¨æ—¶ï¼Œç›¸åº”çš„ä»»åŠ¡ä¼šç«‹å³è¢«æ·»åŠ åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯ä»»åŠ¡ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šåœ¨è®¾å®šçš„å»¶è¿Ÿæ—¶é—´ä¹‹åï¼Œè¢«å–å‡ºå¹¶æ”¾å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œã€‚

### é¡ºåºé¢˜ç›®

```js
const { log } = console

log(1)

setTimeout(() => {
  log(2)
}, 50)

setTimeout(() => {
  log(3)
}) // ä¸å¡« delay åˆ™ä¸ºé»˜è®¤å€¼0

setTimeout(() => {
  log(4)
}, 0)
```

æˆ‘çš„ç­”æ¡ˆæ˜¯ 1342ï¼Œå¥¹çš„æ‰§è¡Œé¡ºåºè¿˜æ˜¯å¾ˆå¥½æ¨æµ‹çš„ï¼Œé¦–å…ˆ 1ï¼Œç„¶åå°±æ˜¯å‰©ä¸‹çš„æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ŒæŒ‰ç…§å®šæ—¶å™¨çš„æ—¶é—´æ‹¿å‡ºæ¥ï¼Œæ‰€ä»¥å°±æ˜¯ 342

```js
const { log } = console

setTimeout(() => {
  log(1)
}, 100)
setTimeout(() => {
  log(2)
}, 50)
setTimeout(() => {
  log(3)
}, 0)
setTimeout(() => {
  log(4)
}, 0)
log(5)
```

åŒç†ï¼Œ53421

## Promise å¾®ä»»åŠ¡

å½“ Promise çš„çŠ¶æ€å˜ä¸ºå·²å…‘ç°æˆ–å·²æ‹’ç»æ—¶ï¼Œä¼šç”Ÿæˆå¾®ä»»åŠ¡ã€‚å¾®ä»»åŠ¡æ˜¯ä¸€ç»„éœ€è¦åœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œç»“æŸåç«‹å³æ‰§è¡Œçš„ä»»åŠ¡æ“ä½œã€‚Promise çš„å›è°ƒå‡½æ•°`.then()`ã€`.catch()`ã€`.finally()`å°±æ˜¯å¾®ä»»åŠ¡ã€‚

æ‰€ä»¥è¯´ï¼Œnew Promise(fn)é‡Œé¢çš„ fn æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚

### é¡ºåºé¢˜ç›®

```js
const { log } = console

Promise.resolve().then(() => {
  log(1)
})

log(2)

new Promise((resolve, reject) => {
  log(3)
  resolve()
})
  .then(() => {
    log(4)
  })
  .then(() => {
    log(5)
  })

Promise.reject()
  .then(() => {
    log(7)
  })
  .catch(() => {
    log(8)
  })
  .finally(() => {
    log(9)
  })
```

è¿™ä¸ªå°±æœ‰ç‚¹é•¿äº†ã€‚é¦–å…ˆæ‰§è¡Œå½“å‰çš„åŒæ­¥ä»£ç ï¼Œ23ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œå¾®ä»»åŠ¡ï¼Œ14859ã€‚

ä¸Šé¢çš„åˆ†ææ˜¯æœ‰é”™è¯¯çš„ï¼Œå®é™…ç­”æ¡ˆæ˜¯ 2314589ï¼ŒåŸå› æ˜¯ï¼š
å…ˆé‡åˆ° 1ï¼ŒæŠŠå®ƒæ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åè¾“å‡º 2ï¼Œé‡åˆ° 3 è¾“å‡ºï¼Œç„¶åæŠŠ 45 æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œåé¢å°±æ˜¯ 89ã€‚

## await å¾®ä»»åŠ¡

await æ˜¯å¼‚æ­¥æ“ä½œç¬¦ï¼Œå®ƒå¯ä»¥ç­‰å¾…ä¸€ä¸ª Promise å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¹¶è¿”å› Promise çš„ç»“æœã€‚await åé¢çš„ä»£ç ä¼šè¢«æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚

### é¡ºåºé¢˜ç›®

```js
const { log } = console

async function async1() {
  log(1)
  await async2()
  log(2)
}

async function async2() {
  log(3)
  return new Promise((resolve, reject) => {
    resolve()
    log(4)
  })
}

async1()
```

1342

1. é¦–å…ˆï¼Œæ‰§è¡Œ async1() å‡½æ•°ã€‚
2. åœ¨ async1() å‡½æ•°å†…éƒ¨ï¼Œé‡åˆ° log(1)ï¼Œæ‰“å°æ•°å­— 1ã€‚
3. ç„¶åï¼Œé‡åˆ° await async2()ï¼Œå®ƒä¼šæš‚åœ async1() å‡½æ•°çš„æ‰§è¡Œï¼Œå¹¶ç­‰å¾… async2() å‡½æ•°çš„ Promise å¯¹è±¡è§£å†³ã€‚
4. æ‰§è¡Œ async2() å‡½æ•°ã€‚
5. åœ¨ async2() å‡½æ•°å†…éƒ¨ï¼Œé‡åˆ° log(3)ï¼Œæ‰“å°æ•°å­— 3ã€‚
6. æ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼Œå¹¶ç«‹å³æ‰§è¡Œ resolve() æ–¹æ³•ï¼Œè¡¨ç¤º Promise æˆåŠŸè§£å†³ã€‚
7. åœ¨æ‰§è¡Œ resolve() åï¼Œé‡åˆ° log(4)ï¼Œæ‰“å°æ•°å­— 4ã€‚
8. async2() å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›è§£å†³çš„ Promise å¯¹è±¡ã€‚
9. å›åˆ° async1() å‡½æ•°ï¼Œç»§ç»­æ‰§è¡Œã€‚
10. ç”±äº async2() å‡½æ•°çš„ Promise å¯¹è±¡å·²ç»è§£å†³ï¼Œawait async2() è¡¨è¾¾å¼ä¼šæ¢å¤æ‰§è¡Œï¼Œå¹¶è¿”å›è§£å†³çš„å€¼ï¼ˆè¿™é‡Œæ˜¯ä¸€ä¸ªç©ºå€¼ï¼‰ã€‚
11. æ¥ç€ï¼Œé‡åˆ° log(2)ï¼Œæ‰“å°æ•°å­— 2ã€‚
12. æ‰§è¡Œå®Œ async1() å‡½æ•°ï¼Œç¨‹åºç»“æŸã€‚

## ç»¼åˆé¢˜ç›®

```js
const { log } = console

async function async1() {
  log('async1 start')
  await async2()
  log('async1 end')
}

async function async2() {
  log('async2 start')
  return new Promise((resolve, reject) => {
    resolve()
    log('async2 promise')
  })
}

log('script start')

setTimeout(function () {
  log('setTimeout')
}, 0)

async1()

new Promise(function (resolve) {
  log('promise1')
  resolve()
})
  .then(function () {
    log('promise2')
  })
  .then(function () {
    log('promise3')
  })

log('script end')

// script start
// async1 start
// async2 start
// async2 promise
// promise1
// script end
// promise2
// promise3
// async1 end
// setTimeout
```

å…¶ä¸­ async çš„éƒ¨åˆ†å¯ä»¥æ”¹æˆå¦‚ä¸‹çš„ promise çš„è¯å°±æ˜¯
å…³é”®ç‚¹å¯ä»¥çœ‹è¿™ä¸ªæ–‡ç« ï¼š[æˆ‘ç»ˆäºææ‡‚äº† async/awaitã€promise å’Œ setTimeout çš„æ‰§è¡Œé¡ºåº](https://juejin.cn/post/7171002835016892453)
// promise2
// promise3
// async1 end

```js
function async1() {
  log('async1 start')
  return async2().then(() => {
    log('async1 end')
  })
}

function async2() {
  log('async2 start')
  return new Promise((resolve, reject) => {
    resolve()
    log('async2 promise')
  })
}
```

## å‚è€ƒæ–‡ç« 

- [åœ¨ï¼ŸèŠèŠæµè§ˆå™¨äº‹ä»¶å¾ªç¯æœºåˆ¶](https://juejin.cn/post/7257044686815313977)
