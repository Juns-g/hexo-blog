---
title: JSä¸­çš„äº‹ä»¶å¾ªçŽ¯æœºåˆ¶
tags:
  - JS
  - å­¦ä¹ 
cover: 'https://pic.imgdb.cn/item/65cdd6cf9f345e8d032f5627.jpg'
keywords: å­¦ä¹  å‰ç«¯ JS
categories: å‰ç«¯
abbrlink: 42193
date: 2024-3-1 12:55:12
---

# JS ä¸­çš„äº‹ä»¶å¾ªçŽ¯æœºåˆ¶

è¿™ä¸ªé¢è¯•ç»å¸¸é—®è¯¶ï¼Œä½†æ˜¯æˆ‘å¥½å‡ æ¬¡å›žç­”çš„éƒ½æ˜¯ä¸å°½å¦‚äººæ„ï¼Œè¿™æ¬¡æ¥å¥½å¥½æžæ‡‚ä¸€ä¸‹çœ‹çœ‹ ðŸ˜¡ã€‚

## å•çº¿ç¨‹çš„ JS

é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ JS æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸ºå•¥ ðŸ˜§ï¼Ÿ

å› ä¸ºä¸€å¼€å§‹è®¾è®¡ä¹‹åˆï¼Œä»–åªæ˜¯ä¸€ä¸ªæµè§ˆå™¨çš„è„šæœ¬è¯­è¨€ï¼Œä¸»è¦å°±æ˜¯æ“æŽ§ DOM å’Œä¸Žç”¨æˆ·äº’åŠ¨ï¼Œå¦‚æžœä»–æ˜¯å¤šçº¿ç¨‹çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºçŽ°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ª DOMï¼Œè°çŸ¥é“ä¼šå‘ç”Ÿå•¥ã€‚

å½“ç„¶ JS ä¹Ÿå¯ä»¥å¤šçº¿ç¨‹ï¼Œä¸‹é¢å¼•ç”¨[é˜®ä¸€å³°åšå®¢](https://www.ruanyifeng.com/blog/2014/10/event-loop.html)çš„è¯ï¼š

> ä¸ºäº†åˆ©ç”¨å¤šæ ¸ CPU çš„è®¡ç®—èƒ½åŠ›ï¼ŒHTML5 æå‡º Web Worker æ ‡å‡†ï¼Œå…è®¸ JavaScript è„šæœ¬åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å­çº¿ç¨‹å®Œå…¨å—ä¸»çº¿ç¨‹æŽ§åˆ¶ï¼Œä¸”ä¸å¾—æ“ä½œ DOMã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ–°æ ‡å‡†å¹¶æ²¡æœ‰æ”¹å˜ JavaScript å•çº¿ç¨‹çš„æœ¬è´¨ã€‚

é‚£è¿™æ ·æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½æ”¾åˆ°äº†ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ï¼Œç„¶åŽä¸€ä¸ªä¸€ä¸ªçš„æ‰§è¡Œã€‚ä½†æ˜¯è¿™æ ·åº”è¯¥è¿˜ä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚æœ‰çš„ä»»åŠ¡è®¡ç®—é‡å¾ˆå¤§ï¼Œæœ‰çš„ä»»åŠ¡å ç”¨æ—¶é—´å¾ˆé•¿ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åŽé¢çš„ä»»åŠ¡æ— æ³•æ‰§è¡Œï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´é¡µé¢å¡æ­»(å› ä¸ºæµè§ˆå™¨çš„æ¸²æŸ“çº¿ç¨‹å’Œ JS çº¿ç¨‹æ˜¯äº’æ–¥çš„)ã€‚

å¦‚æžœæ˜¯å‰è€…ï¼ŒCPU å¿™ä¸è¿‡æ¥ï¼Œå€’ä¹Ÿæ˜¯åˆç†çš„ï¼Œç›´æŽ¥ç­‰å¾…è¿è¡Œç»“æŸå°±è¡Œã€‚ä½†æ˜¯å¦‚æžœæ˜¯åŽè€…ï¼ŒCPU ç©ºé—²ï¼Œä½†æ˜¯å› ä¸º IO è®¾å¤‡æ…¢ï¼Œå…¸åž‹çš„å°±æ˜¯ä»Žç½‘ç»œæŽ¥å£åŽåŽ»æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±æ²¡å¿…è¦ç­‰å¾…ä»–ï¼Œå¯ä»¥å…ˆåŽ»å¤„ç†åˆ«çš„ä»»åŠ¡ï¼Œç­‰ä»–å¥½äº†å†å›žæ¥å¤„ç†ã€‚

æ‰€ä»¥è¯´ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠä»»åŠ¡åˆ†ä¸ºä¸¤ç±»ï¼ŒåŒæ­¥(sync)ä»»åŠ¡ï¼Œå’Œå¼‚æ­¥(async)ä»»åŠ¡ã€‚åŒæ­¥ä»»åŠ¡æŒ‡çš„æ˜¯ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸ŠæŽ’é˜Ÿæ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¿…é¡»å¾—æŒ‰é¡ºåºæ‰§è¡Œçš„äº†ã€‚å¼‚æ­¥ä»»åŠ¡æŒ‡çš„æ˜¯ï¼Œä¸è¿›å…¥ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯è¿›å…¥ä»»åŠ¡é˜Ÿåˆ—(task queue)çš„ä»»åŠ¡ï¼Œåªæœ‰ä»»åŠ¡é˜Ÿåˆ—é€šçŸ¥ä¸»çº¿ç¨‹ï¼ŒæŸä¸ªå¼‚æ­¥ä»»åŠ¡å¯ä»¥æ‰§è¡Œäº†ï¼Œè¿™ä¸ªä»»åŠ¡æ‰ä¼šè¿›å…¥åˆ°ä¸»çº¿ç¨‹ä¸­ä¸­æ‰§è¡Œã€‚

ä¸‹é¢å¼•ç”¨é˜®ä¸€å³°çš„åšå®¢ï¼š

> å…·ä½“æ¥è¯´ï¼Œå¼‚æ­¥æ‰§è¡Œçš„è¿è¡Œæœºåˆ¶å¦‚ä¸‹ã€‚ï¼ˆåŒæ­¥æ‰§è¡Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ä¸ºå®ƒå¯ä»¥è¢«è§†ä¸ºæ²¡æœ‰å¼‚æ­¥ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œã€‚ï¼‰
>
> ï¼ˆ1ï¼‰æ‰€æœ‰åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ˆexecution context stackï¼‰ã€‚
> ï¼ˆ2ï¼‰ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ª"ä»»åŠ¡é˜Ÿåˆ—"ï¼ˆtask queueï¼‰ã€‚åªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æžœï¼Œå°±åœ¨"ä»»åŠ¡é˜Ÿåˆ—"ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚
> ï¼ˆ3ï¼‰ä¸€æ—¦"æ‰§è¡Œæ ˆ"ä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–"ä»»åŠ¡é˜Ÿåˆ—"ï¼Œçœ‹çœ‹é‡Œé¢æœ‰å“ªäº›äº‹ä»¶ã€‚é‚£äº›å¯¹åº”çš„å¼‚æ­¥ä»»åŠ¡ï¼ŒäºŽæ˜¯ç»“æŸç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ‰§è¡Œæ ˆï¼Œå¼€å§‹æ‰§è¡Œã€‚
> ï¼ˆ4ï¼‰ä¸»çº¿ç¨‹ä¸æ–­é‡å¤ä¸Šé¢çš„ç¬¬ä¸‰æ­¥ã€‚

TODO

## é¢˜ç›®

```js
async function async1() {
  console.log('async1 start')
  await async2()
  console.log('async1 end')
}
async function async2() {
  console.log('async2 start')
  return new Promise((resolve, reject) => {
    resolve()
    console.log('async2 promise')
  })
}
console.log('script start')
setTimeout(function () {
  console.log('setTimeout')
}, 0)
async1()

new Promise(function (resolve) {
  console.log('promise1')
  resolve()
})
  .then(function () {
    console.log('promise2')
  })
  .then(function () {
    console.log('promise3')
  })
console.log('script end')

// script start
// async1 start
// async2 start
// async2 promise
// promise1
// script end
// promise2
// promise3
// async1 end
// setTimeout
```
